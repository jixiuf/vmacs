From e68c6df9252d88574cf32545be6801ed74dca689 Mon Sep 17 00:00:00 2001
From: jixiuf <jixiuf@qq.com>
Date: Mon, 25 Aug 2025 13:54:20 +0800
Subject: [PATCH 3/3] four finger swipe switch window left or right

---
 src/input/mod.rs       | 76 +++++++++++++++++++++++-------------------
 src/input/move_grab.rs |  4 +--
 2 files changed, 43 insertions(+), 37 deletions(-)

diff --git a/src/input/mod.rs b/src/input/mod.rs
index 24db3f82..6447777f 100644
--- a/src/input/mod.rs
+++ b/src/input/mod.rs
@@ -3558,42 +3558,48 @@ impl State {
                                 })
                         };
                         if let Some((output, active_window)) = window {
-                            let pos_within_global_space = Rectangle::new(
-                                pos_within_output.loc
-                                    + self
-                                        .niri
-                                        .global_space
-                                        .output_geometry(&output)
-                                        .unwrap()
-                                        .loc
-                                        .to_f64(),
-                                pos_within_output.size,
-                            );
-                            let location =
-                                pos_within_global_space.loc + (pos_within_global_space.size / 2.0);
-                            if self.niri.layout.interactive_move_begin(
-                                active_window.clone(),
-                                &output,
-                                location,
-                            ) {
-                                let start_data = PointerGrabStartData {
-                                    focus: None,
-                                    button: 1,
-                                    location,
-                                };
-                                let grab = MoveGrab::new(
-                                    start_data,
-                                    active_window,
-                                    is_overview_open,
-                                    true,
-                                );
-                                self.niri.seat.get_pointer().unwrap().set_grab(
-                                    self,
-                                    grab,
-                                    SERIAL_COUNTER.next_serial(),
-                                    Focus::Clear,
-                                );
+                            // let pos_within_global_space = Rectangle::new(
+                            //     pos_within_output.loc
+                            //         + self
+                            //             .niri
+                            //             .global_space
+                            //             .output_geometry(&output)
+                            //             .unwrap()
+                            //             .loc
+                            //             .to_f64(),
+                            //     pos_within_output.size,
+                            // );
+                            if delta_x > 0.0 {
+                                self.niri.layout.focus_column_right_or_first();
+                            } else {
+                                self.niri.layout.focus_column_left_or_last();
                             }
+                            // let location =
+                            //     pos_within_global_space.loc + (pos_within_global_space.size / 2.0);
+                            // if self.niri.layout.interactive_move_begin(
+                            //     active_window.clone(),
+                            //     &output,
+                            //     location,
+                            // ) {
+                            //     // let start_data = PointerGrabStartData {
+                            //     //     focus: None,
+                            //     //     button: 1,
+                            //     //     location,
+                            //     // };
+                            //     // let grab = MoveGrab::new(
+                            //     //     start_data,
+                            //     //     active_window,
+                            //     //     is_overview_open,
+                            //     //     true,
+                            //     // );
+                            //     self.niri.layout.focus_column_left_or_last();
+                            //     // self.niri.seat.get_pointer().unwrap().set_grab(
+                            //     //     self,
+                            //     //     grab,
+                            //     //     SERIAL_COUNTER.next_serial(),
+                            //     //     Focus::Clear,
+                            //     // );
+                            // }
                         }
                     }
                 }
diff --git a/src/input/move_grab.rs b/src/input/move_grab.rs
index cd3df51c..7b96d5dd 100644
--- a/src/input/move_grab.rs
+++ b/src/input/move_grab.rs
@@ -222,8 +222,8 @@ impl PointerGrab<State> for MoveGrab {
         handle: &mut PointerInnerHandle<'_, State>,
         event: &GestureSwipeEndEvent,
     ) {
-        // handle.gesture_swipe_end(data, event);
-        handle.unset_grab(self, data, event.serial, event.time, true);
+        handle.gesture_swipe_end(data, event);
+        // handle.unset_grab(self, data, event.serial, event.time, true);
     }
 
     fn gesture_pinch_begin(
-- 
2.49.1

